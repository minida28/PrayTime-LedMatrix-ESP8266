<!DOCTYPE html>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="style.css" type="text/css" />
<div id="page">
<a href="index.htm"  class="btn btn--s">&lt;</a>&nbsp;&nbsp;<strong>Network Information</strong>

<table>
<tr>
	<td colspan="2">
	<span><hr></span>
</td>
</tr>
<tr>
	<td align="right">Hostname :</td>
	<td>
		<span id="hostname"></span>
	</td>
</tr>
<tr>
	<td align="right">Mode :</td>
	<td>
		<span id="mode"></span>
	</td>
</tr>
<tr>
	<td align="right">SSID :</td>
	<td>
		<span id="ssid"></span>
	</td>
</tr>
<tr>
	<td align="right">IP :</td>
	<td>
		<span id="sta_ip"></span>
	</td>
</tr>
<tr>
	<td align="right">Mac :</td>
	<td>
		<span id="sta_mac"></span>
	</td>
</tr>
<tr>
	<td align="right">Netmask :</td>
	<td>
		<span id="netmask"></span>
	</td>
</tr>
<tr>
	<td align="right">Gateway :</td>
	<td>
		<span id="gateway"></span>
	</td>
</tr>
<tr>
	<td align="right">DNS :</td>
	<td>
		<span id="dns"></span>
	</td>
</tr>

<tr>
	<td colspan="2">
	<span><hr></span>
</td>
</tr>
<tr>
	<td align="right">Date :</td>
	<td>
		<span id="x_ntp_date"></span>
	</td>
</tr>
<tr>
  <td align="right">Time :</td>
  <td>
    <span id="x_ntp_time"></span>
  </td>
</tr>
<tr>
  <td align="right">Uptime :</td>
  <td>
     <span id="x_uptime"></span>
  </td>
</tr>
<tr>
  <td align="right">Last sync :</td>
  <td>
    <span id="x_ntp_sync"></span>
  </td>
</tr>
<tr>
  <td align="right">Last boot :</td>
  <td>
     <span id="x_last_boot"></span>
  </td>
</tr>
<tr>
	<td colspan="2" align="center">
		<!--<a href="javascript:GetState(); initEvt()" class="btn btn-m btn-blue">Refresh</a>-->
	</td>
</tr>
</table>
<a style="horizontal-align: center" href="javascript:GetState(); initEvt()" class="btn btn--m btn--blue">Refresh</a>
</div>
<!--<script src="microajax.js"></script>-->
<script>
var ws = null;

window.onload = function () {
  startSocket();
  startEvents();
}
// function ge(s){ return document.getElementById(s);}
// function ce(s){ return document.createElement(s);}
// function stb(){ window.scrollTo(0, document.body.scrollHeight || document.documentElement.scrollHeight); }
// function sendBlob(str){
//   var buf = new Uint8Array(str.length);
//   for (var i = 0; i < str.length; ++i) buf[i] = str.charCodeAt(i);
//   ws.send(buf);
// }
// function addMessage(m){
//   var msg = ce("div");
//   msg.innerText = m;
//   ge("dbg").appendChild(msg);
//   stb();
// }
function startSocket(){
  ws = new WebSocket('ws://'+document.location.host+'/ws',['arduino']);
  ws.binaryType = "arraybuffer";
  ws.onopen = function(e){
    // addMessage("Connected");
		var obj = new Object();
    obj.url = window.location.pathname;
    var myJSON = JSON.stringify(obj);
    ws.send(myJSON);
  };
  ws.onclose = function(e){
    // addMessage("Disconnected");
  };
  ws.onerror = function(e){
    console.log("ws error", e);
    // addMessage("Error");
  };
  ws.onmessage = function(e){
    var msg = "";
    if(e.data instanceof ArrayBuffer){
      msg = "BIN:";
      var bytes = new Uint8Array(e.data);
      for (var i = 0; i < bytes.length; i++) {
        msg += String.fromCharCode(bytes[i]);
      }
    } else {
      msg = "TXT:"+e.data;
    }
    // addMessage(msg);
  };
  // ge("input_el").onkeydown = function(e){
  //   stb();
  //   if(e.keyCode == 13 && ge("input_el").value != ""){
  //     ws.send(ge("input_el").value);
  //     ge("input_el").value = "";
  //   }
  // }
}
function startEvents(){
  var es = new EventSource('/events');
  es.onopen = function(e) {
    // addMessage("Events Opened");
  };
  es.onerror = function(e) {
    if (e.target.readyState != EventSource.OPEN) {
      // addMessage("Events Closed");
    }
  };
  es.onmessage = function(e) {
    // addMessage("Event: " + e.data);
    console.log("Event: " + e.data);
  };
  es.addEventListener('ota', function(e) {
    // addMessage("Event[ota]: " + e.data);
  }, false);
  es.addEventListener('timeDate', function(e) {
    // addMessage("Event[timeDate]: " + e.data);
            var jsonNetworkInfo = JSON.parse(e.data);
            document.getElementById("hostname").textContent = jsonNetworkInfo.hostname;
            document.getElementById("mode").textContent = jsonNetworkInfo.mode;
            document.getElementById("ssid").textContent = jsonNetworkInfo.ssid;
            document.getElementById("sta_ip").textContent = jsonNetworkInfo.sta_ip;
            document.getElementById("sta_mac").textContent = jsonNetworkInfo.sta_mac;
            document.getElementById("netmask").textContent = jsonNetworkInfo.netmask;
            document.getElementById("gateway").textContent = jsonNetworkInfo.gateway;
            document.getElementById("dns").textContent = jsonNetworkInfo.dns;
            // document.getElementById("sta_mac").textContent = jsonNetworkInfo.sta_mac;
  }, false);
}
function onBodyLoad(){
  startSocket();
  startEvents();
  // setInterval(function() {getConfigValues("/admin/infovalues");}, 1000);
}
</script>
<!--<script language="javascript" type="text/javascript">-->
<!--    function initEvt() {-->
<!--        startEvents();-->
<!--    }-->

<!--    function startEvents() {-->
<!--        var evs = new EventSource('/events');-->
<!--        evs.onopen = function (evt) {-->
<!--        };-->

<!--        evs.onerror = function (evt) {-->
<!--            if (evt.target.readyState != EventSource.OPEN) {-->
<!--                console.log("Event source disconnected. Error: " + evt.data);-->
<!--            }-->
<!--        };-->

<!--        evs.onmessage = function (evt) {-->
<!--            console.log("Event " + evt.data);-->
<!--        };-->
<!--        evs.addEventListener('timeDate', function (evt) {-->
            <!--var jsonTimeDate = JSON.parse(evt.data);-->
            <!--document.getElementById("x_ntp_time").innerHTML = jsonTimeDate.time;-->
            <!--document.getElementById("x_ntp_date").innerHTML = jsonTimeDate.date;-->
            <!--document.getElementById("x_ntp_sync").innerHTML = jsonTimeDate.lastSync;-->
            <!--document.getElementById("x_uptime").innerHTML = jsonTimeDate.uptime;-->
            <!--document.getElementById("x_last_boot").innerHTML = jsonTimeDate.lastBoot;-->
<!--        }, false);-->
<!--    }-->
<!--    window.addEventListener('load', initEvt, true);-->
<!--</script>-->