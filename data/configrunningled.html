<!DOCTYPE html>	
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no">
	<link rel="stylesheet" type="text/css" href="siimple.min.css">
	<!--<link rel="stylesheet" type="text/css" href="style.css">-->
	<link rel="shortcut icon" href="favicon.ico">
	<title>System Overview</title>
<style>
/*body {font-family: Verdana, Arial, 'sans-serif';}*/
/*body {font-family: Consolas, monaco, monospace;}*/
.siimple-jumbotron-title, .siimple-table-cell {font-family: "Lucida Sans Typewriter", "Lucida Console", Monaco, "Bitstream Vera Sans Mono", monospace;}
input[type=range]{-webkit-appearance:none;margin:18px 0;width:100%}input[type=range]:focus{outline:none}input[type=range]::-webkit-slider-runnable-track{width:100%;height:8.4px;cursor:pointer;animate:0.2s;box-shadow:1px 1px 1px #000000,0 0 1px #0d0d0d;background:#3071a9;border-radius:1.3px;border:.2px solid #010101}input[type=range]::-webkit-slider-thumb{box-shadow:1px 1px 1px #000000,0 0 1px #0d0d0d;border:1px solid #000;height:36px;width:16px;border-radius:3px;background:#fff;cursor:pointer;-webkit-appearance:none;margin-top:-14px}input[type=range]:focus::-webkit-slider-runnable-track{background:#367ebd}input[type=range]::-moz-range-track{width:100%;height:8.4px;cursor:pointer;animate:0.2s;box-shadow:1px 1px 1px #000000,0 0 1px #0d0d0d;background:#3071a9;border-radius:1.3px;border:.2px solid #010101}input[type=range]::-moz-range-thumb{box-shadow:1px 1px 1px #000000,0 0 1px #0d0d0d;border:1px solid #000;height:36px;width:16px;border-radius:3px;background:#fff;cursor:pointer}input[type=range]::-ms-track{width:100%;height:8.4px;cursor:pointer;animate:0.2s;background:transparent;border-color:transparent;border-width:16px 0;color:transparent}input[type=range]::-ms-fill-lower{background:#2a6495;border:.2px solid #010101;border-radius:2.6px;box-shadow:1px 1px 1px #000000,0 0 1px #0d0d0d}input[type=range]::-ms-fill-upper{background:#3071a9;border:.2px solid #010101;border-radius:2.6px;box-shadow:1px 1px 1px #000000,0 0 1px #0d0d0d}input[type=range]::-ms-thumb{box-shadow:1px 1px 1px #000000,0 0 1px #0d0d0d;border:1px solid #000;height:36px;width:16px;border-radius:3px;background:#fff;cursor:pointer}input[type=range]:focus::-ms-fill-lower{background:#3071a9}input[type=range]:focus::-ms-fill-upper{background:#367ebd}
</style>
</head>
<body>
  <br>

<div class="siimple-content siimple-content--small">
  <div class="siimple-grid">
	  <div class="siimple-grid-row">
	    <div class="siimple-grid-col siimple-grid-col--12">
        <div class="siimple-box siimple-box--pink">
          <div class="siimple-box-title">LED Matrix Settings</div>
          <!--<div class="siimple-box-subtitle">This is the box subtitle</div>-->
          <!--<div class="siimple-box-detail">This is the box detail text</div>-->
        </div>
	    </div>
	  </div>
	  
	  <div class="siimple-grid-row">
	    <div class="siimple-grid-col siimple-grid-col--12">
        <div class="siimple-tabs siimple-tabs--boxed siimple-tab--small">
          <a href="/"><div class="siimple-tabs-tab">Menu</div></a>
          <a href="/info.html"><div class="siimple-tabs-tab">Info</div></a>
          <a href="/sholat.html"><div class="siimple-tabs-tab">Sholat Time</div></a>
        </div>
	    </div>
	  </div>
	  
	  <div class="siimple-grid-row">
	    <div class="siimple-grid-col siimple-grid-col--12">
	      <b><div id="status_box" class="alert alert-info"></div></b>
	    </div>
      <div class="siimple-grid-col siimple-grid-col--6">
      </div>
	  </div>
	  
  <form>
	  
    <div class="siimple-grid-row">
      <div class="siimple-grid-col siimple-grid-col--3 siimple-grid-col-lg--12">
        <label class="siimple-label">Operating Mode</label>
      </div>
      <div class="siimple-grid-col siimple-grid-col--9 siimple-grid-col-lg--12">
        <select class="siimple-select siimple-select--fluid" id="operatingmode" name="operatingmode" onchange="something(this),sendFastConfig(this)">
  			  <option style="display:none" label=" "></option>
  				<option value="0">NORMAL MODE</option>
  				<option value="1">CONFIG MODE</option>
  				<option value="2">EDIT MODE</option>
        </select>
      </div>
    </div>
    
    <div name="pagemode0">
      <div class="siimple-grid-row">
        <div class="siimple-grid-col siimple-grid-col--3 siimple-grid-col-lg--12">
          <label class="siimple-label">NORMAL Mode page</label>
        </div>
        <div class="siimple-grid-col siimple-grid-col--9 siimple-grid-col-lg--12">
  				<select class="siimple-select siimple-select--fluid" id="pagemode0" name="pagemode0" onchange="sendFastConfig(this)">
  				  <option style="display:none" label=" "></option>
  					<option value="0">Jam & Tanggal</option>
  					<option value="1">Waktu Menuju Sholat</option>
  					<option value="2">Waktu Sholat Saat Ini</option>
  					<option value="3">Jam Saja</option>
  					<option value="4">Daya Listrik</option>
  					<option value="5">Long Text</option>
  					<option value="6">Jam dan Temperature</option>
  					<option value="7">Sandbox</option>
  					<option value="8">Waktu Menuju Sholat Type 2</option>
  					<option value="9">Jam Saja Type 2</option>
  					<option value="10">Sandbox 2</option>
  				</select>
        </div>
      </div>
    </div>
    
    <div name="pagemode1">
      <div class="siimple-grid-row">
        <div class="siimple-grid-col siimple-grid-col--3 siimple-grid-col-lg--12">
          <label class="siimple-label">CONFIG Mode page</label>
        </div>
        <div class="siimple-grid-col siimple-grid-col--9 siimple-grid-col-lg--12">
  				<select class="siimple-select siimple-select--fluid" id="pagemode1" name="pagemode1" onchange="sendFastConfig(this)">
  				  <option style="display:none" label=" "></option>
  					<option value="0">DEVICE NAME</option>
  					<option value="1">SSID</option>
  					<option value="2">IP ADDRESS</option>
  					<option value="3">GATEWAY</option>
  					<option value="4">NETMASK</option>
  					<option value="5">MAC ADDRESS</option>
  					<option value="6">DNS ADDRESS</option>
  					<option value="7">LAST SYNC</option>
  					<option value="8">TIME</option>
  					<option value="9">DATE</option>
  					<option value="10">UPTIME</option>
  					<option value="11">LASTBOOT</option>
  					<option value="12">FREEHEAP</option>
  				</select>
        </div>
      </div>
    </div>
    
    <div name="pagemode2">
      <div class="siimple-grid-row">
        <div class="siimple-grid-col siimple-grid-col--3 siimple-grid-col-lg--12">
          <label class="siimple-label">EDIT Mode page</label>
        </div>
        <div class="siimple-grid-col siimple-grid-col--9 siimple-grid-col-lg--12">
  				<select class="siimple-select siimple-select--fluid" id="pagemode2" name="pagemode2" onchange="sendFastConfig(this)">
  				  <option style="display:none" label=" "></option>
  					<option value="0">UNKNOWN</option>
  				</select>
        </div>
      </div>
    </div>
    
      <div class="siimple-grid-row">
        <div class="siimple-grid-col siimple-grid-col--3 siimple-grid-col-lg--12">
          <label class="siimple-label">Page Sequence</label>
        </div>
        <div class="siimple-grid-col siimple-grid-col--9 siimple-grid-col-lg--12">
  				<select class="siimple-select siimple-select--fluid" id="pagemode" name="pagemode" onchange="sendFastConfig(this)">
  				  <option style="display:none" label=" "></option>
  					<option value="Automatic">AUTOMATIC</option>
  					<option value="Manual">MANUAL</option>
  				</select>
        </div>
      </div>
      
      <div class="siimple-grid-row">
        <div class="siimple-grid-col siimple-grid-col--3 siimple-grid-col-lg--6">
          <label class="siimple-label">Scroll Row 0</label>
        </div>
        <div class="siimple-grid-col siimple-grid-col--9 siimple-grid-col-lg--6">
          <div class="siimple-switch">
            <input type="checkbox" id="scrollrow_0" name="scrollrow_0" onchange="sendFastConfig(this)">
            <label for="scrollrow_0"></label>
            <div></div>
          </div>
        </div>
      </div>
      
      <div class="siimple-grid-row">
        <div class="siimple-grid-col siimple-grid-col--3 siimple-grid-col-lg--6">
          <label class="siimple-label">Scroll Row 1</label>
        </div>
        <div class="siimple-grid-col siimple-grid-col--9 siimple-grid-col-lg--6">
          <div class="siimple-switch">
            <input type="checkbox" id="scrollrow_1" name="scrollrow_1" onchange="sendFastConfig(this)">
            <label for="scrollrow_1"></label>
            <div></div>
          </div>
        </div>
      </div>
      
      <div class="siimple-grid-row">
        <div class="siimple-grid-col siimple-grid-col--3 siimple-grid-col-lg--12">
          <label class="siimple-label">Long Text</label><br>
        </div>
        <div class="siimple-grid-col siimple-grid-col--9 siimple-grid-col-lg--12">
          <textarea class="siimple-textarea siimple-textarea--fluid" maxlength = "400" id="longtext" name="longtext" style="resize:none; min-height:50px; max-height:300px;" onkeypress="process(event, this); auto_grow(this)">
          </textarea>
          <label for="btnLongText"></label>
          <button type="button" id="btnLongText" class="siimple-btn siimple-btn--navy" onclick="sendConfig(this.form.longtext)">Update text</button>
        </div>
      </div>
      
      <div class="siimple-grid-row">
        <div class="siimple-grid-col siimple-grid-col--3 siimple-grid-col-lg--12">
          <label for="scrollspeedslider"><b>Scan Frequency</b></label>
        </div>
        <div class="siimple-grid-col siimple-grid-col--9 siimple-grid-col-lg--12">
          <input class="pure-input-1" type="range" min="0" max="60" id="scrollspeedslider" name="scrollspeedslider" step="1" oninput="outputUpdate(this), sendFastConfig(this)" onchange="">
          <output for="scrollspeedslider" id="scrollSpeedValue" name="scrollSpeedValue"></output>
        </div>
      </div>
      
      <div class="siimple-grid-row">
        <div class="siimple-grid-col siimple-grid-col--3 siimple-grid-col-lg--12">
          <label for="brightnessslider"><b>Brightness</b></label>
        </div>
        <div class="siimple-grid-col siimple-grid-col--9 siimple-grid-col-lg--12">
          <input class="pure-input-1" type="range" min="0" max="1023" id="brightnessslider" name="brightnessslider" step="50" oninput="outputUpdate(this), sendFastConfig(this)" onchange="">
          <output for="brightnessslider" id="brightnessValue" name="brightnessValue"></output>
        </div>
      </div>
      
      <div class="siimple-grid-row">
        <div class="siimple-grid-col siimple-grid-col--3 siimple-grid-col-lg--12">
          <label class="siimple-label">Tone 0</label><br>
        </div>
        <div class="siimple-grid-col siimple-grid-col--9 siimple-grid-col-lg--12">
          <label for="btntesttone0"></label>
          <button type="button" id="btntesttone0" name="btntesttone0" class="siimple-btn siimple-btn--navy" onclick="sendFastConfig(this)">Tone0</button>
        </div>
      </div>
      
      <div class="siimple-grid-row">
        <div class="siimple-grid-col siimple-grid-col--3 siimple-grid-col-lg--12">
          <label class="siimple-label">Tone 1</label><br>
        </div>
        <div class="siimple-grid-col siimple-grid-col--9 siimple-grid-col-lg--12">
          <label for="btntesttone1"></label>
          <button type="button" id="btntesttone1" name="btntesttone1" class="siimple-btn siimple-btn--navy" onclick="sendFastConfig(this)">Tone1</button>
        </div>
      </div>
      
      <div class="siimple-grid-row">
        <div class="siimple-grid-col siimple-grid-col--3 siimple-grid-col-lg--12">
          <label class="siimple-label">Tone 2</label><br>
        </div>
        <div class="siimple-grid-col siimple-grid-col--9 siimple-grid-col-lg--12">
          <label for="btntesttone2"></label>
          <button type="button" id="btntesttone2" name="btntesttone2" class="siimple-btn siimple-btn--navy" onclick="sendFastConfig(this)">Tone2</button>
        </div>
      </div>
      
      <div class="siimple-grid-row">
        <div class="siimple-grid-col siimple-grid-col--3 siimple-grid-col-lg--12">
          <label class="siimple-label">Tone 10</label><br>
        </div>
        <div class="siimple-grid-col siimple-grid-col--9 siimple-grid-col-lg--12">
          <label for="btntesttone10"></label>
          <button type="button" id="btntesttone10" name="btntesttone10" class="siimple-btn siimple-btn--navy" onclick="sendFastConfig(this)">Tone10</button>
        </div>
      </div>
      
      <div class="siimple-grid-row">
        <div class="siimple-grid-col siimple-grid-col--3 siimple-grid-col-lg--12">
          <label class="siimple-label">Save Config</label><br>
        </div>
        <div class="siimple-grid-col siimple-grid-col--9 siimple-grid-col-lg--12">
          <label for="btnsaveconfig"></label>
          <button type="button" id="btnsaveconfig" name="btnsaveconfig" class="siimple-btn siimple-btn--navy" onclick="saveConfig(this)">Save Config</button>
        </div>
      </div>

	  </form>
  </div>
</div>

<script language="javascript" type="text/javascript">

var ws = null;
var json;

window.onload = function () {
  getConfigValues("/configrunningled.json");
  startSocket();
  //startEvents();
}
function startSocket(){
  ws = new WebSocket('ws://'+document.location.host+'/ws',['arduino']);
  ws.binaryType = "arraybuffer";
  ws.onopen = function(e){
		var obj = new Object();
    obj.url = window.location.pathname;
    var myJSON = JSON.stringify(obj);
    ws.send(myJSON);
  };
  ws.onclose = function(e){
  };
  ws.onerror = function(e){
    console.log("ws error", e);
  };
  ws.onmessage = function(e){
    var msg = "";
    if(e.data instanceof ArrayBuffer){
      msg = "BIN:";
      var bytes = new Uint8Array(e.data);
      for (var i = 0; i < bytes.length; i++) {
        msg += String.fromCharCode(bytes[i]);
      }
    } else {
      msg = "TXT:"+e.data;
      console.log(msg);
      if (isJSON(e.data)) {
        var json = JSON.parse(e.data);
        // document.getElementById("date").textContent = json.date;
        // document.getElementById("time").textContent = json.time;
        // document.getElementById("uptime").textContent = json.uptime;
        // document.getElementById("lastsync").textContent = json.lastsync;
        // document.getElementById("nextsync").textContent = json.nextsync;
      }
    }
  };
}
// https://stackoverflow.com/questions/3710204/how-to-check-if-a-string-is-a-valid-json-string-in-javascript-without-using-try
function isJSON(str) {
  try {
      return (JSON.parse(str) && !!str);
  } catch (e) {
      return false;
  }
}

function getConfigValues(address) {
  var req = new XMLHttpRequest();
  if (req) {
    req.open("GET", address, true);
    req.addEventListener("load", reqListener);
    req.send();
  }
}
function reqListener () {
  //console.log(this.responseText);
  json = JSON.parse(this.responseText);
  console.log(json);
  document.getElementById("operatingmode").value = parseInt(json.operatingmode);
  document.getElementById("pagemode").value = json.pagemode;
  document.getElementById("pagemode0").value = json.pagemode0;
  document.getElementById("pagemode1").value = json.pagemode1;
  document.getElementById("pagemode2").value = json.pagemode2;
  document.getElementById("scrollrow_0").checked = json.scrollrow_0;
  document.getElementById("scrollrow_1").checked = json.scrollrow_1;
  document.getElementById("scrollspeedslider").value = json.scrollspeed;
  document.getElementById("scrollSpeedValue").value = json.scrollspeed;
  document.getElementById("brightnessslider").value = json.brightness;
  document.getElementById("brightnessValue").value = json.brightness;
  
  something(document.getElementById('operatingmode'));
  // something();
}
function something(element) {
  if (element == document.getElementById('operatingmode')) {
    var text = element.options[element.selectedIndex].text;
    console.log(text);
    if (text == "NORMAL MODE" ) {
      document.getElementsByName('pagemode0')[0].style.display = "inline";
      document.getElementsByName('pagemode1')[0].style.display = "none";
      document.getElementsByName('pagemode2')[0].style.display = "none";
      // document.getElementsByName('pageMode1')[0].hidden = true;
      // document.getElementsByName('pageMode2')[0].hidden = true;
    }
    else if (text == "CONFIG MODE" ) {
      document.getElementsByName('pagemode0')[0].style.display = "none";
      document.getElementsByName('pagemode1')[0].style.display = "inline";
      document.getElementsByName('pagemode2')[0].style.display = "none";
    }
    else if (text == "EDIT MODE" ) {
      document.getElementsByName('pagemode0')[0].style.display = "none";
      document.getElementsByName('pagemode1')[0].style.display = "none";
      document.getElementsByName('pagemode2')[0].style.display = "inline";
    }
  }
}
function saveConfig() {
  json.saveconfig = window.location.pathname;
  json.operatingmode = parseInt(document.getElementById("operatingmode").value);
  json.pagemode = document.getElementById("pagemode").value;
  json.pagemode0 = parseInt(document.getElementById("pagemode0").value);
  json.pagemode1 = parseInt(document.getElementById("pagemode1").value);
  json.pagemode2 = parseInt(document.getElementById("pagemode2").value);
  json.scrollrow_0 = document.getElementById("scrollrow_0").checked;
  json.scrollrow_1 = document.getElementById("scrollrow_1").checked;
  json.scrollspeed = parseInt(document.getElementById("scrollspeedslider").value);
  json.brightness = parseInt(document.getElementById("brightnessslider").value);
  var myJSON = JSON.stringify(json);
  ws.send(myJSON);
  console.log("Data sent: ",myJSON);
}

// function sendConfig(element) {
//   console.log(element);
//   var type = element.type;
//   var nodeName; var nodeId; var value; var text;
//   if (type == 'select-one') {
//     nodeName = element.nodeName; nodeId = element.id; value = element.value; text = element.options[element.selectedIndex].text;
//   }
//   else if (type == 'checkbox') {
//     nodeName = element.nodeName; nodeId = element.id; value = element.checked; text = null;
//   }
//   else if (type == 'range') {
//     nodeName = element.nodeName; nodeId = element.id; value = element.value; text = null;
//   }
//   else if (type == 'textarea') {
//     nodeName = element.nodeName; nodeId = element.id; value = element.value; text = null;
//   }
//   else if (type == 'button') {
//     nodeName = element.nodeName; nodeId = element.id; value = 500; text = null;
//   }
//   console.log("nodeName:" + nodeName,"type:" + type,"nodeId:" + nodeId,"value:" + value,"text:" + text);
//   var obj = new Object();
//   obj.type = "matrixConfig";
//   obj.param = nodeId;
//   obj.value = value;
//   obj.text = text;
//   var myJSON = JSON.stringify(obj);
//   ws.send(myJSON);
//   console.log("Send data: ",myJSON);
// }

function sendFastConfig(element) {
  console.log(element);
  var type = element.type;
  var nodeName; var nodeId; var value; var text;
  if (type == 'select-one') {
    nodeName = element.nodeName; nodeId = element.id; value = element.value; text = element.options[element.selectedIndex].text;
  }
  else if (type == 'checkbox') {
    nodeName = element.nodeName; nodeId = element.id; value = element.checked; text = null;
  }
  else if (type == 'range') {
    nodeName = element.nodeName; nodeId = element.id; value = element.value; text = null;
  }
  else if (type == 'textarea') {
    nodeName = element.nodeName; nodeId = element.id; value = element.value; text = null;
  }
  else if (type == 'button') {
    nodeName = element.nodeName; nodeId = element.id; value = 500; text = null;
  }
  console.log("nodeName:" + nodeName,"type:" + type,"nodeId:" + nodeId,"value:" + value,"text:" + text);
  var obj = new Object();
  obj.type = "matrixConfig";
  obj.param = nodeId;
  obj.value = value;
  obj.text = text;
  var myJSON = JSON.stringify(obj);
  ws.send(myJSON);
  console.log("Send data: ",myJSON);
}

function outputUpdate(element) {
  console.log(element);
  var type = element.type;
  var nodeName; var nodeId; var value; var text;
  if (type == 'select-one') {
    nodeName = element.nodeName; nodeId = element.id; value = element.value; text = element.options[element.selectedIndex].text;
  }
  else if (type == 'checkbox') {
    nodeName = element.nodeName; nodeId = element.id; value = element.checked; text = null;
  }
  else if (type == 'range') {
    nodeName = element.nodeName; nodeId = element.id; value = element.value; text = null;
  }
  else if (type == 'textarea') {
    nodeName = element.nodeName; nodeId = element.id; value = element.value; text = null;
  }
  else if (type == 'button') {
    nodeName = element.nodeName; nodeId = element.id; value = element.label; text = null;
  }
  console.log("nodeName:" + nodeName,"type:" + type,"nodeId:" + nodeId,"value:" + value,"text:" + text);
  
  if (nodeId == 'scrollspeedslider') {
    document.querySelector('#scrollSpeedValue').value = element.value;
  }
  if (nodeId == 'brightnessslider') {
    document.querySelector('#brightnessValue').value = element.value;
  }
}
</script>
</body>
